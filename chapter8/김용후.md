# 계층형 설계
아래 계층의 함수로 현재 계층의 함수를 만드는 법
핵심은 각 계층이 목적을 가지게하고 계층안의 함수들의 추상화 수준을 동일하게 유지해서
읽기 쉽고 깔끔한 구조의 코드를 만드는 것

### 적절한 계층 고르기
함수의 이름을 보아도 좋고 놓고 싶은 계층의 다른 함수들과의 추상화 수준을 비교해보면 적절한 위치를 찾을 수 있음

### 긴 화살표 (계층 건너 뛰기)
![스크린샷 2022-09-22 오후 10 43 29](https://user-images.githubusercontent.com/6914465/191763471-707e1f65-07ac-44b2-98ec-839fb3934f99.png)

책에서 이런 계층간 추상화 정도를 한눈에 보기 좋게 그래프를 그리라하고
그래프에서 길이가 긴 화살표를 없애라 한다. 이것을 계층을 건너뛰는 행위라고 볼 수 있는데

실무에서 자주 발생하는 예로들면 좀 더 가슴에 와닿을듯.

컨트롤러 >> 서비스 >> 영속성 3개의 계층이 있을때  
컨트롤러에서 영속성 엔티티에 접근하는 경우가 딱 그렇다. 추가로 작성할 코드가 없고 간단하니까 하기 좋은 행위임.
이렇게 되면 웹 계층에 영속성 계층의 역할이 섞이면서 문제들이 발생한다. 대표적으로
1. 명시적인 이름을 가지는 useCase 가 없어서 나중가면 뭐하는 코드인지 알아먹기가 힘들다.
2. 컨트롤러에 로직이 박히면서 재사용하기 힘들다.
3. 테스트 하기 힘들다.
  - 전체 기능을 확인하려면 e2e를 돌려야함 => 느림
  - 웹계층만 테스트 하려면 도메인 객체를 mocking 해야함
  - => 테스트 하기 싫어짐

### 그래서 제거하는 법
![스크린샷 2022-09-22 오후 10 43 43](https://user-images.githubusercontent.com/6914465/191763520-d4f6a51c-c7df-4204-8a7a-648808ab98b9.png)
1. 중간 계층에 함수를 하나 만들어서 감싸는 구조로 바꾸는 법이 있다.
2. 계층간 모델을 다 따로 만들고 계층 이동할때마다 완전히 매핑하기

### 생각해볼만한것
계층이 너무 많아지면 각 계층을 어떻게 구별 하는지.
