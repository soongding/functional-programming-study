# Chapter 7

## 용어 정리
### 레거시 코드
- 지금 당장 고칠 수 없어서 그대로 사용해야 하는 코드


### 카피-온-라이트 패턴
- 데이터를 바꾸기 전에 복사 → 무엇을 복사해야할지 알기 때문에 신뢰성이 높음

### **안전지대** ↔ **바깥**
- 데이터가 바뀔 가능성이 있음
- 신뢰할 수 없는 코드가 있기 때문
→ 불변성을 지키면서 데이터를 주고 받는 방법을 찾아야 한다. (카피-온-라이트 패턴)


## 방어적 복사
- 데이터가 바뀌는것을 완벽히 막아주는 원칙
- 원본이 바뀌지 않도록 막아주기 때문에 `방어적` 이다.
- 데이터가 나가기전 / 나갈 때 복사한다.

### 방어적 복사 규칙

#### 규칙 1 데이터가 안전한 코드에서 나갈 때 복사하기

1. 깊은 복사본을 만들어 내보낸다.
2. 신뢰할 수 없는 코드로 복사본을 전달한다.

#### 규칙 2 안전한 코드로 데이터가 들어올 때 복사하기

1. 변경 가능한 데이터가 들어오면 일단 깊은 복사본을 만든다.
2. 그 복사본을 안전한 코드로 전달한다.

### 참고
- 대부분 웹 기반 API는 암묵적으로 방어적 복사를 한다.
- Request, Response JSON 데이터가 깊은 복사본이다.

### 카피-온-라이트 VS 방어적 복사

| | 카피-온-라이트| 방어적 복사|
|-----|------------------------|-------------------------------|
|언제? |통제할 수 있는 데이터 변경할 때 |신뢰할 수 없는 코드와 데이터 주고 받을 때|
|어디서? |안전지대 어디에서든 | 안전지대 ↔ 바깥 경계에서 사용|
|복사 방식 | 얕은 복사|깊은 복사 |
|규칙 | 1.바꿀 데이터의 얕은 복사본을 만든다.<br/> 2.복사본을 변경한다 <br/> 3.복사본을 리턴한다.| 들어오는 데이터도 깊은 복사본 <br/> 나가는 데이터도 깊은 복사본|
|불변성 |유지함 |유지함 |
