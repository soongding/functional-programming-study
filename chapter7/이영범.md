# 개요

### 방어적 복사

데이터를 변경할 수도 있는 코드와 불변성 코드 사이에 데이터를 주고 받기 위한 원칙

- 두 가지 규칙
    - 데이터가 안전한 코드에서 나갈 때 복사하기
        
        변경 불가능한 데이터가 신뢰할 수 없는 코드로 나갈 때, 아래 단계로 원본 데이터를 보호할 수 있음
        
        1. 불변성 데이터를 위한 깊은 복사본을 만듦
        2. 신뢰할 수 없는 코드로 복사본을 전달
    - 안전한 코드로 데이터가 들어올 때 복사하기
        
        신뢰할 수 없는 코드에서 변경될 수도 있는 데이터가 들어온다면 다음 단계를 따름
        
        1. 변경될 수도 있는 데이터가 들어오면 바로 깊은 복사본을 만들어 안전한 코드로 전달
        2. 복사본을 안전한 코드에서 사용
- 위 규칙을 순서에 상관없이 사용할 수 있음

### 카피-온-라이트 vs 방어적 복사

- 카피-온-라이트
    - 언제 쓰는지
        - 통제할 수 있는 데이터를 바꿀 때 카피-온-라이트를 쓴다
    - 어디서 쓰는지
        - 안전지대 어디서나 쓸 수 있다
        - 사실 카피-온-라이트가 불변경을 가진 안전지대를 만든다
    - 복사 방식
        - 얕은 복사(상대적으로 비용이 적게 듬)
    - 규칙
        1. 바꿀 떼이터의 얕은 복사를 만든다
        2. 복사본을 변경한다
        3. 복사본을 리턴한다
- 방어적 복사
    - 언제 쓰는지
        - 신뢰할 수 없는 코드와 데이터를 주고 받아야 할 때 방어적 복사를 쓴다
    - 어디서 쓰는지
        - 안전지대의 경계에서 데이터가 오고 갈 때 방어적 복사를 쓴다
    - 복사 방식
        - 깊은 복사(상대적으로 비용이 많이 든다)
    - 규칙
        1. 안전지대로 들어오는 데이터의 깊은 복사를 만든다
        2. 안전지대에서 나가는 데이터에 깊은 복사를 만든다
